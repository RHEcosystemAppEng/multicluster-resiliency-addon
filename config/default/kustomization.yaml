# This kustomize file is used for kustomizing the deployment of the Addon Manager.
# Use the json/patch patches for fine-tuning the Addon Manager workload.
# Start here for addon deployment.
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: open-cluster-management

resources:
  - ../crd
  - ../rbac
  - ../addon
  - ../metrics #[METRICS_PROXY]
  - ../webhook #[WEBHOOK]
  - ../certmanager #[CERT_MANAGER]

patches:
  - path: patches/addon_manager_auth_proxy.yaml #[METRICS_PROXY]
  - path: patches/addon_manager_validating_rstc_webhook.yaml #[WEBHOOK]
  - path: patches/validating_webhook_certmanager_annotations.yaml #[CERT_MANAGER]

replicas:
  - name: manager
    count: 1

commonLabels:
  app.kubernetes.io/part-of: multicluster-resiliency-addon

# this breaks for devel versions
#buildMetadata:
#  - managedByLabel
labels:
  - pairs:
      app.kubernetes.io/managed-by: kustomize
    includeTemplates: true

replacements:
  - path: kustomizereplace.yaml
  - path: kustomizereplace_certmanager.yaml #[CERT_MANAGER]
